
LOAD CSV WITH HEADERS FROM 'file:///countries.csv' AS row
MERGE (c:Country {MCC: row.MCC})
SET c.Country = row.Country,
    c.Continent = row.Continent;


LOAD CSV WITH HEADERS FROM 'file:///networks.csv' AS row
MERGE (n:Network {MCC: row.MCC, MNC: row.MNC})
SET n.Network = row.Network;


// Consultas Cypher
¿Cuál es la proporción de cada tipo de red, por país, en Sudamérica?
¿Cuáles son los países con mayor y menor cantidad de operadores en el mundo?
¿En qué países se han añadido la mayor y menor cantidad de torres en el último año?¿De qué tipo fueron?


// Primero convertir las fechas almacenadas como strings a datetime
MATCH (t:CellTower)
SET t.Created = datetime(t.Created),
    t.Updated = datetime(t.Updated)


//Consulta Cypher para Proporción de Cada Tipo de Red por País en America del sur
MATCH (t:CellTower)-[:LOCATED_IN]->(c:Country {Continent: "Oceania"})
WITH c, t.Radio AS network_type
WITH c, network_type, COUNT(*) AS count_per_type
MATCH (c)<-[:LOCATED_IN]-(t2:CellTower)
WITH c, network_type, count_per_type, COUNT(*) AS total_towers
RETURN c.Country AS Country,
       network_type AS Network_Type,
       count_per_type AS Count_Per_Type,
       total_towers AS Total_Towers,
       toFloat(count_per_type) / total_towers AS Proportion
ORDER BY c.Country, Proportion DESC


// Encuentra los países con la mayor cantidad de operadores
MATCH (c:Country)<-[:LOCATED_IN]-(t:CellTower)-[:OPERATED_BY]->(n:Network)
WITH c, COUNT(DISTINCT n) AS num_operators
RETURN c.Country AS Country, num_operators
ORDER BY num_operators DESC
LIMIT 2

UNION

// Encuentra los países con la menor cantidad de operadores
MATCH (c:Country)<-[:LOCATED_IN]-(t:CellTower)-[:OPERATED_BY]->(n:Network)
WITH c, COUNT(DISTINCT n) AS num_operators
RETURN c.Country AS Country, num_operators
ORDER BY num_operators ASC
LIMIT 3


//Consulta para el país con la mayor cantidad de torres añadidas en el último año:
WITH datetime() - duration({years: 1}) AS one_year_ago
MATCH (t:CellTower)-[:LOCATED_IN]->(c:Country)
WHERE t.Created >= one_year_ago
WITH c.Country AS country, COUNT(t) AS num_towers, COLLECT(t.Radio) AS types
ORDER BY num_towers DESC
WITH HEAD(collect({country: country, num_towers: num_towers, types: types})) AS result
RETURN result.country AS Country, result.num_towers AS Num_Towers, result.types AS Types

UNION

//Consulta para el país con la menor cantidad de torres añadidas en el último año
WITH datetime() - duration({years: 1}) AS one_year_ago
MATCH (t:CellTower)-[:LOCATED_IN]->(c:Country)
WHERE t.Created >= one_year_ago
WITH c.Country AS country, COUNT(t) AS num_towers, COLLECT(t.Radio) AS types
ORDER BY num_towers ASC
WITH HEAD(collect({country: country, num_towers: num_towers, types: types})) AS result
RETURN result.country AS Country, result.num_towers AS Num_Towers, result.types AS Types



